# Feedback for Gelato

The following feedback is based on my experience building this project based on the tutorial provided here: https://www.gelato.network/blog/gasless-nft-minting-using-usdc

I want to first state that this blog post is a top search result for search phrases like "how to use usdc for minting an nft." I am building an online game where I want to sell a "deluxe pass" for 1 USDC. I want to do this because I think that's a fair price and I think it's becoming more common for people to get USDC (such as from Farcaster rewards). I'd really like it if users could spend USDC without having to have ETH in their wallet. So I was very interested in finding a solution that can just use USDC. And I like the idea of using an NFT for the purchase, because then it's easy to verify that someone holds a "deluxe pass" and therefore has access to the premium features in my game. So I found this tutorial and it made it sound like I could just follow the examples and get USDC minting working, plus I like how the relay can be used onchain without having to sign up for a Gelato account / plan... very permissionless!

Unfortunately it's not that easy to actually get it working. The first issue I ran into was that USDC is not supported on any testnets. The only asset supported on most testnets is WETH. Further, the tutorial and example code relies on the token contract having a `nonces` function: https://github.com/gelatodigital/rel-gasless-nft-usdc-example/blob/master/frontend/src/abi/ERC20Permit.ts#L4

The WETH contract does not have this. So I had two big hurdles after writing my contract and depoloying it on Ethereum Sepolia. First, I tried to mint with USDC and it failed, and it wasn't until I looked through the Relay docs that I eventually found out that USDC is not a supported contract on any testnet. This is unfortunate because Circle has an official faucet for testnets, it's really easy to get 10 testnet USDC on Sepolia, so it would be a really nice DevEx if I could actually use it. Then the second hurdle was I rewrote my contract to use WETH for testing, deployed it, and then was not able to actually test the minting with the frontend code running because the code would fail at the point of trying to instantiate the token contract with the ABI and finding it does not have a `nonces` function. 

So I eventually gave up with testing on a testnet and decided to deploy on a mainnet. Now it gets a bit frustrating because I am burning real money to test and work out the remaining issues with my contract. Fortunately it costs only a few cents to deploy on Base Mainnet, but it's still me spending money to test something. That's when I ran into the next issue, which had me stuck for hours. It's a really difficult issue to diagnose. The issue is in the signature method that the example code uses: https://github.com/gelatodigital/rel-gasless-nft-usdc-example/blob/master/frontend/src/util/sign.ts#L8

The signature payload uses version `1` and a salt. But the USDC contract uses version 2 and the chain ID, not a salt. The correct signature payload looks like this: https://github.com/Montoya/msdlx-frontend-mint/blob/main/src/util/sign.ts#L19 (you will notice I commented out the incorrect signature example above the correct one from my code). 

I was completely stuck until I found this out in a random stack exchange thread about a different issue!

Now I have an implementation that mostly works. The only remaining issue is that sometimes the mint fails due to insufficient fee. I am not sure why that happens. It seems like sometimes the minimum gas needed goes up and the fee ends up not being enough to do the mint. But I have tried sometimes with double or even triple the calculated fee passed as the fee and it still fails. It may be that something else goes wrong. The one thing I have found that seems to help is increasing the frequency with which the fee gets updated on the frontend. So maybe it's just a matter of getting the correct estimated fee based on the current block. Here's my updated timing: https://github.com/Montoya/msdlx-frontend-mint/blob/main/src/components/App/index.tsx#L116 (1 second instead of 10 seconds). 

---

Here's my advice: there is an excellent use case here for anyone who wants to accept USDC with the fee paid in USDC. There should be an updated tutorial and documentation that fits this use case specifically. The testnet relays should also be updated to accept testnet USDC. Everything should be laid out clearly so a developer can come along and build a use case that uses USDC and ensure it works correctly on testnet before deploying to mainnet and then be able to use the most popular L2s (like Base) for their production deployment. I think if the Gelato team could spend some time updating everything for this use case specifically, it would be worthwhile. 

Thanks for reading my feedback. 
